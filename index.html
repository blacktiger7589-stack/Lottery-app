<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡πÅ‡∏≠‡∏û‡∏Ñ‡∏µ‡∏¢‡πå‡∏´‡∏ß‡∏¢</title>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
body{margin:0;padding:12px;font-family:sans-serif;background:#f2f6f3}
.container{max-width:1300px;margin:auto;background:#fff;padding:16px;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.08)}
h2,h3,h4{text-align:center;margin:10px 0}
input,select,button{width:100%;padding:12px;font-size:16px;margin:6px 0;border-radius:10px;border:1px solid #ccc}
button{background:#2e7d32;color:#fff;border:none}
button.danger{background:#d9534f}
button.gray{background:#888}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.flex{display:flex;gap:8px}
.number-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(70px,1fr));gap:6px}
.card{border:1px dashed #bbb;padding:12px;margin-top:16px;border-radius:14px;background:#fafafa}
.table-wrap{overflow-x:auto}
table{border-collapse:collapse;width:100%;font-size:14px}
th,td{border:1px solid #ccc;padding:6px;text-align:center}
th{background:#f1f1f1}
.total{text-align:right;font-size:18px;margin-top:8px}
.result{background:#eef6ff;padding:8px;border-radius:8px;margin-top:6px}
.warn{background:#fff8e1;padding:10px;border-radius:10px}
.half{color:#d9534f;font-weight:bold}
.tag{background:#fdecea;color:#d9534f;padding:4px 10px;border-radius:20px;margin:4px;display:inline-block}
.blessing{text-align:center;margin-top:8px;font-style:italic;color:#2e7d32}
hr{margin:20px 0}
</style>
</head>

<body>
<div class="container">

<h2>üì± ‡πÅ‡∏≠‡∏û‡∏Ñ‡∏µ‡∏¢‡πå‡∏´‡∏ß‡∏¢</h2>
<button class="danger" onclick="clearAll()">üßπ ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>

<input id="buyer" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡∏ã‡∏∑‡πâ‡∏≠">

<div class="grid">
  <select id="digit"></select>
  <select id="type"></select>
</div>

<div class="number-grid" id="numbers"></div>

<div id="money1"><input id="amount1" type="number" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô"></div>
<div id="money2" class="flex" style="display:none">
  <input id="amountA" type="number" placeholder="‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà 1">
  <input id="amountB" type="number" placeholder="‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà 2">
</div>

<button onclick="addItems()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>

<hr>

<h3>üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</h3>
<div id="personArea"></div>

<hr>

<h3>‚ö†Ô∏è ‡πÄ‡∏•‡∏Ç‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß</h3>
<div class="warn">
  <div class="flex">
    <input id="halfInput" placeholder="‡πÉ‡∏™‡πà‡πÄ‡∏•‡∏Ç 2 ‡∏´‡∏£‡∏∑‡∏≠ 3 ‡∏ï‡∏±‡∏ß">
    <button onclick="addHalf()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
  </div>
  <div id="halfList"></div>
</div>

<hr>

<h3>üèÜ ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</h3>

<h4>‡πÄ‡∏•‡∏Ç 2 ‡∏ï‡∏±‡∏ß</h4>
<div class="grid">
  <input id="win2top" placeholder="‡πÄ‡∏•‡∏Ç‡∏ö‡∏ô">
  <input id="win2bottom" placeholder="‡πÄ‡∏•‡∏Ç‡∏•‡πà‡∏≤‡∏á">
</div>
<button onclick="search2()">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏•‡∏Ç 2 ‡∏ï‡∏±‡∏ß</button>
<div id="search2Result" class="card"></div>
<button onclick="saveImage(search2Result)">üì∏ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏†‡∏≤‡∏û‡∏ú‡∏•‡πÄ‡∏•‡∏Ç 2 ‡∏ï‡∏±‡∏ß</button>

<hr>

<h4>‡πÄ‡∏•‡∏Ç 3 ‡∏ï‡∏±‡∏ß</h4>
<input id="win3" placeholder="‡πÄ‡∏•‡∏Ç 3 ‡∏ï‡∏±‡∏ß">
<button onclick="search3()">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏•‡∏Ç 3 ‡∏ï‡∏±‡∏ß</button>
<div id="search3Result" class="card"></div>
<button onclick="saveImage(search3Result)">üì∏ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏†‡∏≤‡∏û‡∏ú‡∏•‡πÄ‡∏•‡∏Ç 3 ‡∏ï‡∏±‡∏ß</button>

<hr>

<h3>üåç ‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏£‡πâ‡∏≤‡∏ô</h3>
<div id="overallArea"></div>
<button onclick="saveImage(overallArea)">üì∏ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏†‡∏≤‡∏û‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</button>
<button class="gray" onclick="exportCSV()">üìÑ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å Excel</button>

</div>

<script>
document.addEventListener("DOMContentLoaded",()=>{

const $=id=>document.getElementById(id);

let data=JSON.parse(localStorage.getItem("lottery_data"))||{};
let halfNums=JSON.parse(localStorage.getItem("half_nums"))||[];

function save(){localStorage.setItem("lottery_data",JSON.stringify(data));localStorage.setItem("half_nums",JSON.stringify(halfNums));}

for(let i=0;i<10;i++) $("numbers").innerHTML+=`<input placeholder="‡πÄ‡∏•‡∏Ç">`;

$("digit").innerHTML=`<option value="2">‡πÄ‡∏•‡∏Ç 2 ‡∏ï‡∏±‡∏ß</option><option value="3">‡πÄ‡∏•‡∏Ç 3 ‡∏ï‡∏±‡∏ß</option>`;
$("digit").onchange=updateType;
$("type").onchange=updateMoney;

function updateType(){
  $("type").innerHTML="";
  if($("digit").value==="2"){
    ["2 ‡∏ï‡∏±‡∏ß‡∏ö‡∏ô","2 ‡∏ï‡∏±‡∏ß‡∏•‡πà‡∏≤‡∏á","2 ‡∏ï‡∏±‡∏ß‡∏ö‡∏ô/‡∏•‡πà‡∏≤‡∏á"].forEach(t=>$("type").innerHTML+=`<option>${t}</option>`);
  }else{
    ["3 ‡∏ï‡∏±‡∏ß‡∏ï‡∏£‡∏á","3 ‡∏ï‡∏±‡∏ß‡πÇ‡∏ï‡πä‡∏î","3 ‡∏ï‡∏±‡∏ß‡∏ï‡∏£‡∏á/‡πÇ‡∏ï‡πä‡∏î"].forEach(t=>$("type").innerHTML+=`<option>${t}</option>`);
  }
  updateMoney();
}
function updateMoney(){
  if($("type").value.includes("/")){
    $("money1").style.display="none";
    $("money2").style.display="flex";
  }else{
    $("money1").style.display="block";
    $("money2").style.display="none";
  }
}

updateType();

function normalize3(n){return n.split("").sort().join("")}
function isHalf(num){
  return halfNums.some(h=>h.length===num.length && (h.length===2? h===num : normalize3(h)===normalize3(num)));
}
function mark(n){return isHalf(n)?`<span class="half">${n}</span>`:n}

window.addItems=()=>{
  const name=$("buyer").value.trim();
  if(!name) return alert("‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡∏ã‡∏∑‡πâ‡∏≠");
  const nums=[...$("numbers").querySelectorAll("input")].map(i=>i.value.trim()).filter(Boolean);
  if(!nums.length) return alert("‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏ä‡πà‡∏≠‡∏á");
  data[name]=data[name]||{items:[],total:0};
  nums.forEach(n=>{
    let r={num:n,top:0,bottom:0,straight:0,tod:0},s=0;
    const t=$("type").value;
    if(t==="2 ‡∏ï‡∏±‡∏ß‡∏ö‡∏ô"){r.top=+$("amount1").value;s=r.top}
    if(t==="2 ‡∏ï‡∏±‡∏ß‡∏•‡πà‡∏≤‡∏á"){r.bottom=+$("amount1").value;s=r.bottom}
    if(t==="2 ‡∏ï‡∏±‡∏ß‡∏ö‡∏ô/‡∏•‡πà‡∏≤‡∏á"){r.top=+$("amountA").value;r.bottom=+$("amountB").value;s=r.top+r.bottom}
    if(t==="3 ‡∏ï‡∏±‡∏ß‡∏ï‡∏£‡∏á"){r.straight=+$("amount1").value;s=r.straight}
    if(t==="3 ‡∏ï‡∏±‡∏ß‡πÇ‡∏ï‡πä‡∏î"){r.tod=+$("amount1").value;s=r.tod}
    if(t==="3 ‡∏ï‡∏±‡∏ß‡∏ï‡∏£‡∏á/‡πÇ‡∏ï‡πä‡∏î"){r.straight=+$("amountA").value;r.tod=+$("amountB").value;s=r.straight+r.tod}
    data[name].items.push(r);data[name].total+=s;
  });
  clearInputs();save();render();
};

function clearInputs(){
  [...$("numbers").querySelectorAll("input")].forEach(i=>i.value="");
  $("amount1").value=$("amountA").value=$("amountB").value="";
}

function discount(t){return t>=500?0.15:t>=200?0.10:0}

function render(){
  $("personArea").innerHTML="";
  let overall={};
  for(const name in data){
    const d=data[name],dis=discount(d.total),net=d.total-(d.total*dis);
    $("personArea").innerHTML+=`
    <div class="card" id="bill-${name}">
      <b>${name}</b>
      <div class="table-wrap">
      <table>
      <tr><th>‡πÄ‡∏•‡∏Ç</th><th>‡∏ö‡∏ô</th><th>‡∏•‡πà‡∏≤‡∏á</th><th>‡∏ï‡∏£‡∏á</th><th>‡πÇ‡∏ï‡πä‡∏î</th><th>‡∏•‡∏ö</th></tr>
      ${d.items.map((i,idx)=>`
        <tr>
          <td>${mark(i.num)}</td>
          <td>${i.top||"-"}</td>
          <td>${i.bottom||"-"}</td>
          <td>${i.straight||"-"}</td>
          <td>${i.tod||"-"}</td>
          <td><button onclick="removeItem('${name}',${idx})">‚ùå</button></td>
        </tr>`).join("")}
      </table></div>
      <div class="total">‡∏£‡∏ß‡∏° ${d.total} | ‡∏•‡∏î ${dis*100}% | <b>‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ ${net}</b></div>
      <div class="blessing">‚ú® ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡πÇ‡∏ä‡∏Ñ‡∏î‡∏µ‡πÅ‡∏•‡∏∞‡∏ñ‡∏π‡∏Å‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏∏‡∏Å‡∏á‡∏ß‡∏î‡∏Ñ‡πà‡∏∞ ‚ú®</div>
      <button onclick="saveImage(document.getElementById('bill-${name}'))">üì∏ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏†‡∏≤‡∏û‡∏ö‡∏¥‡∏•</button>
    </div>`;
    d.items.forEach(i=>{
      overall[i.num]=overall[i.num]||{top:0,bottom:0,straight:0,tod:0};
      overall[i.num].top+=i.top;overall[i.num].bottom+=i.bottom;
      overall[i.num].straight+=i.straight;overall[i.num].tod+=i.tod;
    });
  }
  renderOverall(overall);
}

window.removeItem=(n,i)=>{data[n].items.splice(i,1);if(!data[n].items.length)delete data[n];save();render();};

function renderOverall(o){
  if(!Object.keys(o).length){$("overallArea").innerHTML="<div class='card'>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>";return;}
  let sum=0;
  $("overallArea").innerHTML=`
  <div class="table-wrap"><table>
  <tr><th>‡πÄ‡∏•‡∏Ç</th><th>‡∏ö‡∏ô</th><th>‡∏•‡πà‡∏≤‡∏á</th><th>‡∏ï‡∏£‡∏á</th><th>‡πÇ‡∏ï‡πä‡∏î</th><th>‡∏£‡∏ß‡∏°</th></tr>
  ${Object.keys(o).map(k=>{const s=o[k].top+o[k].bottom+o[k].straight+o[k].tod;sum+=s;
    return `<tr><td>${mark(k)}</td><td>${o[k].top||"-"}</td><td>${o[k].bottom||"-"}</td><td>${o[k].straight||"-"}</td><td>${o[k].tod||"-"}</td><td>${s}</td></tr>`}).join("")}
  </table></div><div class="total">üí∞ ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏£‡πâ‡∏≤‡∏ô: ${sum} ‡∏ö‡∏≤‡∏ó</div>`;
}

window.addHalf=()=>{const v=$("halfInput").value.trim();if(v&&!halfNums.includes(v)){halfNums.push(v);$("halfInput").value="";save();renderHalf();}};
window.removeHalf=v=>{halfNums=halfNums.filter(x=>x!==v);save();renderHalf();};
function renderHalf(){$("halfList").innerHTML=halfNums.map(n=>`<span class="tag">${n} <button onclick="removeHalf('${n}')">‚ùå</button></span>`).join("");}
renderHalf();

window.search2=()=>{
  $("search2Result").innerHTML="";let total=0;
  for(const n in data){
    data[n].items.forEach(i=>{
      if($("win2top").value&&i.num===$("win2top").value&&i.top){let p=i.top*70;if(isHalf(i.num))p/=2;total+=p;$("search2Result").innerHTML+=`<div class="result">${n} ${mark(i.num)} ‡∏ö‡∏ô ‡∏à‡πà‡∏≤‡∏¢ ${p}</div>`;}
      if($("win2bottom").value&&i.num===$("win2bottom").value&&i.bottom){let p=i.bottom*70;if(isHalf(i.num))p/=2;total+=p;$("search2Result").innerHTML+=`<div class="result">${n} ${mark(i.num)} ‡∏•‡πà‡∏≤‡∏á ‡∏à‡πà‡∏≤‡∏¢ ${p}</div>`;}
    });
  }
  $("search2Result").innerHTML+=`<div class="total">‡∏£‡∏ß‡∏°‡∏à‡πà‡∏≤‡∏¢ ${total}</div>`;
};

window.search3=()=>{
  $("search3Result").innerHTML="";let total=0;const w=$("win3").value,n=normalize3(w);
  for(const name in data){
    data[name].items.forEach(i=>{
      if(i.num===w&&i.straight){let p=i.straight*500;if(isHalf(w))p/=2;total+=p;$("search3Result").innerHTML+=`<div class="result">${name} ${mark(w)} ‡∏ï‡∏£‡∏á ‡∏à‡πà‡∏≤‡∏¢ ${p}</div>`;}
      if(i.tod&&normalize3(i.num)===n){let p=i.tod*100;if(isHalf(w))p/=2;total+=p;$("search3Result").innerHTML+=`<div class="result">${name} ${mark(i.num)} ‡πÇ‡∏ï‡πä‡∏î ‡∏à‡πà‡∏≤‡∏¢ ${p}</div>`;}
    });
  }
  $("search3Result").innerHTML+=`<div class="total">‡∏£‡∏ß‡∏°‡∏à‡πà‡∏≤‡∏¢ ${total}</div>`;
};

window.saveImage=el=>html2canvas(el).then(c=>{const a=document.createElement("a");a.href=c.toDataURL();a.download="result.png";a.click();});
window.exportCSV=()=>{let csv="‡πÄ‡∏•‡∏Ç,‡∏ö‡∏ô,‡∏•‡πà‡∏≤‡∏á,‡∏ï‡∏£‡∏á,‡πÇ‡∏ï‡πä‡∏î,‡∏£‡∏ß‡∏°\n";document.querySelectorAll("#overallArea tr").forEach((r,i)=>{if(i)csv+=[...r.children].map(td=>td.innerText).join(",")+"\n"});const a=document.createElement("a");a.href="data:text/csv;charset=utf-8,"+encodeURIComponent(csv);a.download="summary.csv";a.click();};
window.clearAll=()=>{if(confirm("‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?")&&confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á")){data={};halfNums=[];localStorage.clear();render();renderHalf();}};

render();
});
</script>
</body>
</html>
