<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡πÅ‡∏≠‡∏û‡∏Ñ‡∏µ‡∏¢‡πå‡∏´‡∏ß‡∏¢</title>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
body{
  margin:0;
  padding:12px;
  font-family:sans-serif;
  background:#f2f6f3;
}
.container{
  max-width:1300px;
  margin:auto;
  background:#fff;
  padding:16px;
  border-radius:16px;
  box-shadow:0 10px 30px rgba(0,0,0,.08);
}
h2,h3{
  text-align:center;
  margin:10px 0;
}
input,select,button{
  width:100%;
  padding:12px;
  font-size:16px;
  margin:6px 0;
  border-radius:10px;
  border:1px solid #ccc;
}
button{
  background:#2e7d32;
  color:#fff;
  border:none;
}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.flex{display:flex;gap:8px}
.number-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(70px,1fr));
  gap:6px;
}
.card{
  border:1px dashed #bbb;
  padding:12px;
  margin-top:16px;
  border-radius:14px;
  background:#fafafa;
}
.table-wrap{overflow-x:auto}

/* ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ä‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô */
table{
  border-collapse:collapse;
  width:100%;
  font-size:14px;
}
th,td{
  border:1px solid #ccc;
  padding:4px 6px;
  text-align:center;
  line-height:1.2;
}
th{background:#f1f1f1}

.total{
  text-align:left;   /* üëà ‡∏¢‡πâ‡∏≤‡∏¢‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡πÑ‡∏õ‡∏ã‡πâ‡∏≤‡∏¢ */
  font-size:16px;
  margin-top:6px;
}

.blessing{
  margin-top:8px;
  text-align:center;
  font-style:italic;
  color:#2e7d32;
}

/* ‡∏ã‡πà‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö‡∏ï‡∏≠‡∏ô‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ */
.no-print{display:table-cell}
.hide-for-image .no-print{display:none !important}

hr{margin:20px 0}
</style>
</head>

<body>
<div class="container">

<h2>üì± ‡πÅ‡∏≠‡∏û‡∏Ñ‡∏µ‡∏¢‡πå‡∏´‡∏ß‡∏¢</h2>

<input id="buyer" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡∏ã‡∏∑‡πâ‡∏≠">

<div class="grid">
  <select id="digit">
    <option value="2">‡πÄ‡∏•‡∏Ç 2 ‡∏ï‡∏±‡∏ß</option>
    <option value="3">‡πÄ‡∏•‡∏Ç 3 ‡∏ï‡∏±‡∏ß</option>
  </select>
  <select id="type"></select>
</div>

<div class="number-grid" id="numbers"></div>

<div id="money1">
  <input id="amount1" type="number" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô">
</div>

<div id="money2" class="flex" style="display:none">
  <input id="amountA" type="number" placeholder="‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà 1">
  <input id="amountB" type="number" placeholder="‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà 2">
</div>

<button onclick="addItems()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>

<hr>

<h3>üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</h3>
<div id="personArea"></div>

</div>

<script>
document.addEventListener("DOMContentLoaded",()=>{

const buyer = document.getElementById("buyer");
const digit = document.getElementById("digit");
const type = document.getElementById("type");
const numbers = document.getElementById("numbers");
const money1 = document.getElementById("money1");
const money2 = document.getElementById("money2");
const amount1 = document.getElementById("amount1");
const amountA = document.getElementById("amountA");
const amountB = document.getElementById("amountB");
const personArea = document.getElementById("personArea");

let data = JSON.parse(localStorage.getItem("lottery_data")) || {};

/* init ‡∏ä‡πà‡∏≠‡∏á‡πÄ‡∏•‡∏Ç */
for(let i=0;i<10;i++){
  numbers.innerHTML += `<input placeholder="‡πÄ‡∏•‡∏Ç">`;
}

/* ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó */
digit.addEventListener("change",updateType);
type.addEventListener("change",updateMoney);

function updateType(){
  type.innerHTML="";
  if(digit.value==="2"){
    type.innerHTML += `
      <option>2 ‡∏ï‡∏±‡∏ß‡∏ö‡∏ô</option>
      <option>2 ‡∏ï‡∏±‡∏ß‡∏•‡πà‡∏≤‡∏á</option>
      <option>2 ‡∏ï‡∏±‡∏ß‡∏ö‡∏ô/‡∏•‡πà‡∏≤‡∏á</option>`;
  }else{
    type.innerHTML += `
      <option>3 ‡∏ï‡∏±‡∏ß‡∏ï‡∏£‡∏á</option>
      <option>3 ‡∏ï‡∏±‡∏ß‡πÇ‡∏ï‡πä‡∏î</option>
      <option>3 ‡∏ï‡∏±‡∏ß‡∏ï‡∏£‡∏á/‡πÇ‡∏ï‡πä‡∏î</option>`;
  }
  updateMoney();
}

function updateMoney(){
  if(type.value.includes("/")){
    money1.style.display="none";
    money2.style.display="flex";
  }else{
    money1.style.display="block";
    money2.style.display="none";
  }
}

updateType();

/* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ */
window.addItems = ()=>{
  const name = buyer.value.trim();
  if(!name) return alert("‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡∏ã‡∏∑‡πâ‡∏≠");

  const nums = [...numbers.querySelectorAll("input")]
    .map(i=>i.value.trim())
    .filter(Boolean);

  if(!nums.length) return alert("‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏ä‡πà‡∏≠‡∏á");

  data[name] = data[name] || {items:[],total:0};

  nums.forEach(n=>{
    let r={num:n,top:0,bottom:0,straight:0,tod:0},sum=0;
    if(type.value==="2 ‡∏ï‡∏±‡∏ß‡∏ö‡∏ô"){r.top=+amount1.value;sum=r.top}
    if(type.value==="2 ‡∏ï‡∏±‡∏ß‡∏•‡πà‡∏≤‡∏á"){r.bottom=+amount1.value;sum=r.bottom}
    if(type.value==="2 ‡∏ï‡∏±‡∏ß‡∏ö‡∏ô/‡∏•‡πà‡∏≤‡∏á"){
      r.top=+amountA.value;
      r.bottom=+amountB.value;
      sum=r.top+r.bottom;
    }
    if(type.value==="3 ‡∏ï‡∏±‡∏ß‡∏ï‡∏£‡∏á"){r.straight=+amount1.value;sum=r.straight}
    if(type.value==="3 ‡∏ï‡∏±‡∏ß‡πÇ‡∏ï‡πä‡∏î"){r.tod=+amount1.value;sum=r.tod}
    if(type.value==="3 ‡∏ï‡∏±‡∏ß‡∏ï‡∏£‡∏á/‡πÇ‡∏ï‡πä‡∏î"){
      r.straight=+amountA.value;
      r.tod=+amountB.value;
      sum=r.straight+r.tod;
    }
    data[name].items.push(r);
    data[name].total+=sum;
  });

  localStorage.setItem("lottery_data",JSON.stringify(data));
  clearInputs();
  render();
};

function clearInputs(){
  [...numbers.querySelectorAll("input")].forEach(i=>i.value="");
  amount1.value="";
  amountA.value="";
  amountB.value="";
}

/* ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• */
function render(){
  personArea.innerHTML="";
  for(const name in data){
    const d=data[name];
    personArea.innerHTML+=`
    <div class="card" id="bill-${name}">
      <b>${name}</b>
      <div class="table-wrap">
      <table>
        <tr>
          <th>‡πÄ‡∏•‡∏Ç</th>
          <th>‡∏ö‡∏ô</th>
          <th>‡∏•‡πà‡∏≤‡∏á</th>
          <th>‡∏ï‡∏£‡∏á</th>
          <th>‡πÇ‡∏ï‡πä‡∏î</th>
          <th class="no-print">‡∏•‡∏ö</th>
        </tr>
        ${d.items.map((i,idx)=>`
        <tr>
          <td>${i.num}</td>
          <td>${i.top||"-"}</td>
          <td>${i.bottom||"-"}</td>
          <td>${i.straight||"-"}</td>
          <td>${i.tod||"-"}</td>
          <td class="no-print">
            <button onclick="removeItem('${name}',${idx})">‚ùå</button>
          </td>
        </tr>`).join("")}
      </table>
      </div>

      <div class="total">
        ‡∏£‡∏ß‡∏° <b>${d.total}</b> ‡∏ö‡∏≤‡∏ó
      </div>

      <div class="blessing">
        ‚ú® ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡πÇ‡∏ä‡∏Ñ‡∏î‡∏µ‡πÅ‡∏•‡∏∞‡∏ñ‡∏π‡∏Å‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏∏‡∏Å‡∏á‡∏ß‡∏î‡∏Ñ‡πà‡∏∞ ‚ú®
      </div>

      <button onclick="saveImage(document.getElementById('bill-${name}'))">
        üì∏ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏†‡∏≤‡∏û‡∏ö‡∏¥‡∏•
      </button>
    </div>`;
  }
}

window.removeItem = (name,idx)=>{
  data[name].items.splice(idx,1);
  if(!data[name].items.length) delete data[name];
  localStorage.setItem("lottery_data",JSON.stringify(data));
  render();
};

/* ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏†‡∏≤‡∏û */
window.saveImage = (el)=>{
  el.classList.add("hide-for-image");
  html2canvas(el).then(c=>{
    const a=document.createElement("a");
    a.href=c.toDataURL("image/png");
    a.download="bill.png";
    a.click();
    el.classList.remove("hide-for-image");
  });
};

render();
});
</script>

</body>
</html>
