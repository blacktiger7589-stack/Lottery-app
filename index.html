<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡πÅ‡∏≠‡∏û‡∏Ñ‡∏µ‡∏¢‡πå‡∏´‡∏ß‡∏¢</title>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
body{margin:0;padding:12px;font-family:sans-serif;background:#f2f6f3}
.container{max-width:1200px;margin:auto;background:#fff;padding:16px;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.08)}
h2,h3,h4{text-align:center;margin:10px 0}
input,button{width:100%;padding:10px;margin:4px 0;border-radius:8px;border:1px solid #ccc}
button{background:#2e7d32;color:#fff;border:none;cursor:pointer}
button.danger{background:#d9534f}
button.gray{background:#888}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:6px}
.card{border:1px dashed #bbb;padding:12px;margin-top:16px;border-radius:14px;background:#fafafa}
table{border-collapse:collapse;width:100%;font-size:14px}
th,td{border:1px solid #ccc;padding:4px 6px;text-align:center}
th{background:#f1f1f1}
.total{text-align:left;margin-top:6px;font-weight:bold}
.blessing{text-align:center;margin-top:6px;font-style:italic;color:#2e7d32}
.no-print{display:table-cell}
.hide-for-image .no-print{display:none !important}
.half{color:#d9534f;font-weight:bold}
.tag{background:#fdecea;color:#d9534f;padding:4px 8px;border-radius:20px;margin:4px;display:inline-block}
hr{margin:20px 0}
</style>
</head>

<body>
<div class="container">

<h2>üì± ‡πÅ‡∏≠‡∏û‡∏Ñ‡∏µ‡∏¢‡πå‡∏´‡∏ß‡∏¢</h2>
<button class="danger" onclick="clearAll()">üßπ ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>

<input id="buyer" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡∏ã‡∏∑‡πâ‡∏≠">

<h3>‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏•‡∏Ç 2 ‡∏ï‡∏±‡∏ß</h3>
<div class="grid">
<input id="num2" placeholder="‡πÄ‡∏•‡∏Ç 2 ‡∏ï‡∏±‡∏ß">
<input id="amt2top" type="number" placeholder="‡∏ö‡∏ô">
<input id="amt2bottom" type="number" placeholder="‡∏•‡πà‡∏≤‡∏á">
</div>
<button onclick="add2()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏•‡∏Ç 2 ‡∏ï‡∏±‡∏ß</button>

<h3>‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏•‡∏Ç 3 ‡∏ï‡∏±‡∏ß</h3>
<div class="grid">
<input id="num3" placeholder="‡πÄ‡∏•‡∏Ç 3 ‡∏ï‡∏±‡∏ß">
<input id="amt3straight" type="number" placeholder="‡∏ï‡∏£‡∏á">
<input id="amt3tod" type="number" placeholder="‡πÇ‡∏ï‡πä‡∏î">
</div>
<button onclick="add3()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏•‡∏Ç 3 ‡∏ï‡∏±‡∏ß</button>

<hr>

<h3>üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</h3>
<div id="personArea"></div>

<hr>

<h3>‚ö†Ô∏è ‡πÄ‡∏•‡∏Ç‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß</h3>
<div class="grid">
<input id="halfInput" placeholder="‡πÄ‡∏•‡∏Ç">
<button onclick="addHalf()">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
</div>
<div id="halfList"></div>

<hr>

<h3>üèÜ ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</h3>

<h4>‡πÄ‡∏•‡∏Ç 2 ‡∏ï‡∏±‡∏ß</h4>
<div class="grid">
<input id="win2top" placeholder="‡∏ö‡∏ô">
<input id="win2bottom" placeholder="‡∏•‡πà‡∏≤‡∏á">
</div>
<button onclick="search2()">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
<div id="search2Result" class="card"></div>

<h4>‡πÄ‡∏•‡∏Ç 3 ‡∏ï‡∏±‡∏ß</h4>
<input id="win3" placeholder="‡πÄ‡∏•‡∏Ç 3 ‡∏ï‡∏±‡∏ß">
<button onclick="search3()">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
<div id="search3Result" class="card"></div>

<hr>

<h3>üåç ‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏£‡πâ‡∏≤‡∏ô</h3>
<div id="overallArea"></div>
<button class="gray" onclick="saveImage(overallArea)">üì∏ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏†‡∏≤‡∏û</button>

</div>

<script>
const $=id=>document.getElementById(id);

let data=JSON.parse(localStorage.getItem("lottery_data")||"{}");
let halfNums=JSON.parse(localStorage.getItem("half_nums")||"[]");

function save(){
localStorage.setItem("lottery_data",JSON.stringify(data));
localStorage.setItem("half_nums",JSON.stringify(halfNums));
}

function discount(t){return t>=500?0.15:t>=200?0.10:0}
function normalize3(n){return n.split("").sort().join("")}
function isHalf(n){
return halfNums.some(h=>h.length===n.length&&(h.length===2?h===n:normalize3(h)===normalize3(n)));
}
function mark(n){return isHalf(n)?`<span class="half">${n}</span>`:n}

function add2(){
const name=$("buyer").value.trim();
if(!name)return alert("‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡πà‡∏≠‡∏ô");
const num=$("num2").value.trim();
if(!num)return;
data[name]=data[name]||[];
data[name].push({num,top:+$("amt2top").value||0,bottom:+$("amt2bottom").value||0,straight:0,tod:0});
save();render();
$("num2").value="";$("amt2top").value="";$("amt2bottom").value="";
}

function add3(){
const name=$("buyer").value.trim();
if(!name)return alert("‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡πà‡∏≠‡∏ô");
const num=$("num3").value.trim();
if(!num)return;
data[name]=data[name]||[];
data[name].push({num,top:0,bottom:0,straight:+$("amt3straight").value||0,tod:+$("amt3tod").value||0});
save();render();
$("num3").value="";$("amt3straight").value="";$("amt3tod").value="";
}

function render(){
$("personArea").innerHTML="";
let overall={};
for(const name in data){
let total=0;
let html=`<div class="card"><b>${name}</b><table>
<tr><th>‡πÄ‡∏•‡∏Ç</th><th>‡∏ö‡∏ô</th><th>‡∏•‡πà‡∏≤‡∏á</th><th>‡∏ï‡∏£‡∏á</th><th>‡πÇ‡∏ï‡πä‡∏î</th><th class="no-print">‡∏•‡∏ö</th></tr>`;
data[name].forEach((i,idx)=>{
let s=i.top+i.bottom+i.straight+i.tod;
total+=s;
overall[i.num]=overall[i.num]||{top:0,bottom:0,straight:0,tod:0};
overall[i.num].top+=i.top;
overall[i.num].bottom+=i.bottom;
overall[i.num].straight+=i.straight;
overall[i.num].tod+=i.tod;
html+=`<tr>
<td>${mark(i.num)}</td>
<td>${i.top||"-"}</td>
<td>${i.bottom||"-"}</td>
<td>${i.straight||"-"}</td>
<td>${i.tod||"-"}</td>
<td class="no-print"><button onclick="removeItem('${name}',${idx})">‚ùå</button></td>
</tr>`;
});
let dis=discount(total);
let net=total-(total*dis);
html+=`</table>
<div class="total">‡∏£‡∏ß‡∏° ${total} | ‡∏•‡∏î ${dis*100}% | ‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ ${net}</div>
<div class="blessing">‚ú® ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡πÇ‡∏ä‡∏Ñ‡∏î‡∏µ‡πÅ‡∏•‡∏∞‡∏ñ‡∏π‡∏Å‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏∏‡∏Å‡∏á‡∏ß‡∏î‡∏Ñ‡πà‡∏∞ ‚ú®</div>
<button onclick="saveImage(this.parentElement)">üì∏ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏†‡∏≤‡∏û‡∏ö‡∏¥‡∏•</button>
</div>`;
$("personArea").innerHTML+=html;
}
renderOverall(overall);
}

function renderOverall(o){
if(!Object.keys(o).length){$("overallArea").innerHTML="‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";return;}
let sum=0;
let html="<table><tr><th>‡πÄ‡∏•‡∏Ç</th><th>‡∏ö‡∏ô</th><th>‡∏•‡πà‡∏≤‡∏á</th><th>‡∏ï‡∏£‡∏á</th><th>‡πÇ‡∏ï‡πä‡∏î</th><th>‡∏£‡∏ß‡∏°</th></tr>";
for(const k in o){
let s=o[k].top+o[k].bottom+o[k].straight+o[k].tod;
sum+=s;
html+=`<tr>
<td>${mark(k)}</td>
<td>${o[k].top||"-"}</td>
<td>${o[k].bottom||"-"}</td>
<td>${o[k].straight||"-"}</td>
<td>${o[k].tod||"-"}</td>
<td>${s}</td></tr>`;
}
html+="</table><div class='total'>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏£‡πâ‡∏≤‡∏ô "+sum+"</div>";
$("overallArea").innerHTML=html;
}

function removeItem(name,idx){
data[name].splice(idx,1);
if(!data[name].length)delete data[name];
save();render();
}

function addHalf(){
const v=$("halfInput").value.trim();
if(!v)return;
if(!halfNums.includes(v))halfNums.push(v);
$("halfInput").value="";
save();renderHalf();render();
}

function renderHalf(){
$("halfList").innerHTML=halfNums.map(n=>`<span class="tag">${n} <button onclick="removeHalf('${n}')">‚ùå</button></span>`).join("");
}

function removeHalf(n){
halfNums=halfNums.filter(x=>x!==n);
save();renderHalf();render();
}

function search2(){
let total=0;$("search2Result").innerHTML="";
for(const name in data){
data[name].forEach(i=>{
if($("win2top").value&&i.num===$("win2top").value&&i.top){
let p=i.top*70;if(isHalf(i.num))p/=2;total+=p;
$("search2Result").innerHTML+=`${name} ${mark(i.num)} ‡∏ö‡∏ô ‡∏à‡πà‡∏≤‡∏¢ ${p}<br>`;
}
if($("win2bottom").value&&i.num===$("win2bottom").value&&i.bottom){
let p=i.bottom*70;if(isHalf(i.num))p/=2;total+=p;
$("search2Result").innerHTML+=`${name} ${mark(i.num)} ‡∏•‡πà‡∏≤‡∏á ‡∏à‡πà‡∏≤‡∏¢ ${p}<br>`;
}
});
}
$("search2Result").innerHTML+=`<div class='total'>‡∏£‡∏ß‡∏°‡∏à‡πà‡∏≤‡∏¢ ${total}</div>`;
}

function search3(){
let total=0;$("search3Result").innerHTML="";
const w=$("win3").value;
for(const name in data){
data[name].forEach(i=>{
if(i.num===w&&i.straight){
let p=i.straight*500;if(isHalf(w))p/=2;total+=p;
$("search3Result").innerHTML+=`${name} ${mark(w)} ‡∏ï‡∏£‡∏á ‡∏à‡πà‡∏≤‡∏¢ ${p}<br>`;
}
if(i.tod&&normalize3(i.num)===normalize3(w)){
let p=i.tod*100;if(isHalf(w))p/=2;total+=p;
$("search3Result").innerHTML+=`${name} ${mark(i.num)} ‡πÇ‡∏ï‡πä‡∏î ‡∏à‡πà‡∏≤‡∏¢ ${p}<br>`;
}
});
}
$("search3Result").innerHTML+=`<div class='total'>‡∏£‡∏ß‡∏°‡∏à‡πà‡∏≤‡∏¢ ${total}</div>`;
}

function saveImage(el){
el.classList.add("hide-for-image");
html2canvas(el).then(c=>{
const a=document.createElement("a");
a.href=c.toDataURL();
a.download="result.png";
a.click();
el.classList.remove("hide-for-image");
});
}

function clearAll(){
if(confirm("‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?")&&confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á?")){
data={};halfNums=[];
localStorage.removeItem("lottery_data");
localStorage.removeItem("half_nums");
render();renderHalf();
}
}

render();
renderHalf();
</script>
</body>
</html>
