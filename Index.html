<!-- ===== FINAL LOTTERY APP ‚Äì FULL VERSION ===== -->
<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡πÅ‡∏≠‡∏û‡∏Ñ‡∏µ‡∏¢‡πå‡∏´‡∏ß‡∏¢ (‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå)</title>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
body{margin:0;padding:10px;font-family:sans-serif;background:#f2f2f2}
.container{max-width:1300px;margin:auto;background:#fff;padding:12px;border-radius:12px}
h2,h3,h4{text-align:center;margin:8px 0}
input,select,button{padding:10px;font-size:16px;width:100%;margin:4px 0}
button{background:#2c7;color:#fff;border:none;border-radius:8px}
button.danger{background:#d9534f}
button.gray{background:#888}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.flex{display:flex;gap:6px}
.number-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(70px,1fr));gap:6px}
.card{border:2px dashed #aaa;padding:10px;margin-top:15px;border-radius:10px;background:#fafafa}
.table-wrap{overflow-x:auto}
table{border-collapse:collapse;min-width:800px;width:100%;font-size:14px}
th,td{border:1px solid #ccc;padding:6px;text-align:center}
th{background:#eee}
.total{text-align:right;font-size:18px;margin-top:8px}
.result{background:#eef;padding:6px;border-radius:6px;margin-top:6px}
.warn{background:#fff3cd;padding:8px;border-radius:6px}
.half{color:#d9534f;font-weight:bold}
.tag{background:#fdecea;color:#d9534f;padding:4px 8px;border-radius:12px;margin:2px;display:inline-block}
hr{margin:18px 0}
</style>
</head>

<body>
<div class="container">

<h2>üì± ‡πÅ‡∏≠‡∏û‡∏Ñ‡∏µ‡∏¢‡πå‡∏´‡∏ß‡∏¢ (‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå)</h2>
<button class="danger" onclick="clearAllData()">üßπ ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>

<!-- ===== KEY INPUT ===== -->
<input id="buyer" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡∏ã‡∏∑‡πâ‡∏≠">

<div class="grid">
  <select id="digit" onchange="updateType()">
    <option value="2">‡πÄ‡∏•‡∏Ç 2 ‡∏ï‡∏±‡∏ß</option>
    <option value="3">‡πÄ‡∏•‡∏Ç 3 ‡∏ï‡∏±‡∏ß</option>
  </select>
  <select id="type" onchange="updateMoney()"></select>
</div>

<div class="number-grid" id="numbers"></div>

<div id="money1"><input id="amount1" type="number" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô"></div>
<div id="money2" class="flex" style="display:none">
  <input id="amountA" type="number" placeholder="‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà 1">
  <input id="amountB" type="number" placeholder="‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà 2">
</div>

<button onclick="addItems()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>

<hr>

<!-- ===== PERSON SUMMARY ===== -->
<h3>üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</h3>
<div id="personArea"></div>

<hr>

<!-- ===== HALF CONDITION ===== -->
<h3>‚ö†Ô∏è ‡πÄ‡∏•‡∏Ç‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß</h3>
<div class="warn">
  <div class="flex">
    <input id="halfInput" placeholder="‡πÉ‡∏™‡πà‡πÄ‡∏•‡∏Ç 2 ‡∏´‡∏£‡∏∑‡∏≠ 3 ‡∏ï‡∏±‡∏ß">
    <button onclick="addHalf()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
  </div>
  <div id="halfList"></div>
</div>

<hr>

<!-- ===== SEARCH ===== -->
<h3>üèÜ ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</h3>

<h4>‡πÄ‡∏•‡∏Ç 2 ‡∏ï‡∏±‡∏ß</h4>
<div class="grid">
  <input id="win2top" placeholder="‡πÄ‡∏•‡∏Ç‡∏ö‡∏ô">
  <input id="win2bottom" placeholder="‡πÄ‡∏•‡∏Ç‡∏•‡πà‡∏≤‡∏á">
</div>
<button onclick="search2()">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏•‡∏Ç 2 ‡∏ï‡∏±‡∏ß</button>
<div id="search2Result" class="card"></div>
<button onclick="saveImage(search2Result)">üì∏ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏†‡∏≤‡∏û‡∏ú‡∏•‡πÄ‡∏•‡∏Ç 2 ‡∏ï‡∏±‡∏ß</button>

<hr>

<h4>‡πÄ‡∏•‡∏Ç 3 ‡∏ï‡∏±‡∏ß</h4>
<input id="win3" placeholder="‡πÄ‡∏•‡∏Ç 3 ‡∏ï‡∏±‡∏ß">
<button onclick="search3()">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏•‡∏Ç 3 ‡∏ï‡∏±‡∏ß</button>
<div id="search3Result" class="card"></div>
<button onclick="saveImage(search3Result)">üì∏ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏†‡∏≤‡∏û‡∏ú‡∏•‡πÄ‡∏•‡∏Ç 3 ‡∏ï‡∏±‡∏ß</button>

<hr>

<!-- ===== OVERALL SUMMARY ===== -->
<h3>üåç ‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏£‡πâ‡∏≤‡∏ô</h3>
<div id="overallArea"></div>
<button onclick="saveImage(overallArea)">üì∏ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏†‡∏≤‡∏û‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</button>
<button class="gray" onclick="exportCSV()">üìÑ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å Excel</button>

</div>

<script>
/* ================= DATA ================= */
let data = JSON.parse(localStorage.getItem("lottery_data")) || {};
let halfNums = JSON.parse(localStorage.getItem("half_nums")) || {};

function saveStorage(){
  localStorage.setItem("lottery_data", JSON.stringify(data));
  localStorage.setItem("half_nums", JSON.stringify(halfNums));
}

/* ================= INIT ================= */
function init(){
  for(let i=0;i<10;i++) numbers.innerHTML+=`<input placeholder="‡πÄ‡∏•‡∏Ç">`;
  updateType();
  render();
  renderHalf();
}
init();

/* ================= UI ================= */
function updateType(){
  type.innerHTML="";
  (digit.value==="2"
    ?["2 ‡∏ï‡∏±‡∏ß‡∏ö‡∏ô","2 ‡∏ï‡∏±‡∏ß‡∏•‡πà‡∏≤‡∏á","2 ‡∏ï‡∏±‡∏ß‡∏ö‡∏ô/‡∏•‡πà‡∏≤‡∏á"]
    :["3 ‡∏ï‡∏±‡∏ß‡∏ï‡∏£‡∏á","3 ‡∏ï‡∏±‡∏ß‡πÇ‡∏ï‡πä‡∏î","3 ‡∏ï‡∏±‡∏ß‡∏ï‡∏£‡∏á/‡πÇ‡∏ï‡πä‡∏î"]
  ).forEach(t=>type.innerHTML+=`<option>${t}</option>`);
  updateMoney();
}
function updateMoney(){
  const t=type.value;
  money1.style.display=t.includes("/")?"none":"block";
  money2.style.display=t.includes("/")?"flex":"none";
}

/* ================= ADD ITEMS ================= */
function addItems(){
  const name=buyer.value.trim();
  if(!name) return alert("‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡∏ã‡∏∑‡πâ‡∏≠");
  const nums=[...numbers.querySelectorAll("input")].map(i=>i.value.trim()).filter(Boolean);
  if(!nums.length) return alert("‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏ä‡πà‡∏≠‡∏á");

  data[name]=data[name]||{items:[],total:0};

  nums.forEach(n=>{
    let r={num:n,top:0,bottom:0,straight:0,tod:0},s=0;
    if(type.value==="2 ‡∏ï‡∏±‡∏ß‡∏ö‡∏ô"){r.top=+amount1.value;s=r.top}
    if(type.value==="2 ‡∏ï‡∏±‡∏ß‡∏•‡πà‡∏≤‡∏á"){r.bottom=+amount1.value;s=r.bottom}
    if(type.value==="2 ‡∏ï‡∏±‡∏ß‡∏ö‡∏ô/‡∏•‡πà‡∏≤‡∏á"){r.top=+amountA.value;r.bottom=+amountB.value;s=r.top+r.bottom}
    if(type.value==="3 ‡∏ï‡∏±‡∏ß‡∏ï‡∏£‡∏á"){r.straight=+amount1.value;s=r.straight}
    if(type.value==="3 ‡∏ï‡∏±‡∏ß‡πÇ‡∏ï‡πä‡∏î"){r.tod=+amount1.value;s=r.tod}
    if(type.value==="3 ‡∏ï‡∏±‡∏ß‡∏ï‡∏£‡∏á/‡πÇ‡∏ï‡πä‡∏î"){r.straight=+amountA.value;r.tod=+amountB.value;s=r.straight+r.tod}
    data[name].items.push(r); data[name].total+=s;
  });
  clearInputs(); saveStorage(); render();
}

/* ================= HALF CONDITION ================= */
function addHalf(){
  const v=halfInput.value.trim();
  if(!v||halfNums.includes(v)) return;
  halfNums.push(v); halfInput.value="";
  saveStorage(); renderHalf();
}
function removeHalf(v){
  halfNums=halfNums.filter(x=>x!==v);
  saveStorage(); renderHalf();
}
function renderHalf(){
  halfList.innerHTML="";
  halfNums.forEach(n=>{
    halfList.innerHTML+=`<span class="tag">${n} <button onclick="removeHalf('${n}')">‚ùå</button></span>`;
  });
}
function normalize3(n){return n.split("").sort().join("")}
function isHalf(num){
  return halfNums.some(h=>{
    if(h.length===2) return h===num;
    if(h.length===3) return normalize3(h)===normalize3(num);
  });
}
function mark(num){return isHalf(num)?`<span class="half">${num}</span>`:num}

/* ================= RENDER PERSON ================= */
function discount(t){return t>=500?0.15:t>=200?0.10:0}

function render(){
  personArea.innerHTML="";
  let overall={};

  for(let name in data){
    const d=data[name];
    let dis=discount(d.total);
    let net=d.total-(d.total*dis);

    personArea.innerHTML+=`
    <div class="card" id="bill-${name}">
      <b>${name}</b>
      <div class="table-wrap">
      <table>
        <tr><th>‡πÄ‡∏•‡∏Ç</th><th>‡∏ö‡∏ô</th><th>‡∏•‡πà‡∏≤‡∏á</th><th>‡∏ï‡∏£‡∏á</th><th>‡πÇ‡∏ï‡πä‡∏î</th><th>‡∏•‡∏ö</th></tr>
        ${d.items.map((i,idx)=>`
        <tr>
          <td>${mark(i.num)}</td>
          <td>${i.top||"-"}</td>
          <td>${i.bottom||"-"}</td>
          <td>${i.straight||"-"}</td>
          <td>${i.tod||"-"}</td>
          <td><button onclick="removeItem('${name}',${idx})">‚ùå</button></td>
        </tr>`).join("")}
      </table>
      </div>
      <div class="total">
        ‡∏£‡∏ß‡∏° ${d.total} | ‡∏•‡∏î ${dis*100}% | <b>‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ ${net}</b>
      </div>
      <button onclick="saveImage(document.getElementById('bill-${name}'))">üì∏ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏†‡∏≤‡∏û‡∏ö‡∏¥‡∏•</button>
    </div>`;

    d.items.forEach(i=>{
      overall[i.num]=overall[i.num]||{top:0,bottom:0,straight:0,tod:0};
      overall[i.num].top+=i.top;
      overall[i.num].bottom+=i.bottom;
      overall[i.num].straight+=i.straight;
      overall[i.num].tod+=i.tod;
    });
  }

  renderOverall(overall);
}

/* ================= REMOVE ================= */
function removeItem(person,index){
  data[person].items.splice(index,1);
  if(!data[person].items.length) delete data[person];
  saveStorage(); render();
}

/* ================= OVERALL ================= */
function renderOverall(overall){
  let sumAll=0;
  overallArea.innerHTML=`
  <div class="table-wrap">
  <table>
    <tr><th>‡πÄ‡∏•‡∏Ç</th><th>‡∏ö‡∏ô</th><th>‡∏•‡πà‡∏≤‡∏á</th><th>‡∏ï‡∏£‡∏á</th><th>‡πÇ‡∏ï‡πä‡∏î</th><th>‡∏£‡∏ß‡∏°</th></tr>
    ${Object.keys(overall).map(k=>{
      const s=overall[k].top+overall[k].bottom+overall[k].straight+overall[k].tod;
      sumAll+=s;
      return `<tr>
        <td>${mark(k)}</td>
        <td>${overall[k].top||"-"}</td>
        <td>${overall[k].bottom||"-"}</td>
        <td>${overall[k].straight||"-"}</td>
        <td>${overall[k].tod||"-"}</td>
        <td>${s}</td>
      </tr>`;
    }).join("")}
  </table>
  </div>
  <div class="total">üí∞ ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏£‡πâ‡∏≤‡∏ô: ${sumAll} ‡∏ö‡∏≤‡∏ó</div>`;
}

/* ================= SEARCH ================= */
function search2(){
  search2Result.innerHTML=""; let total=0;
  const t=win2top.value.trim(),b=win2bottom.value.trim();
  for(let n in data){
    data[n].items.forEach(i=>{
      if(t&&i.num===t&&i.top>0){
        let p=i.top*70; if(isHalf(t)) p/=2;
        total+=p; search2Result.innerHTML+=`<div class="result">üë§ ${n} | ${mark(t)} ‡∏ö‡∏ô | ‡∏à‡πà‡∏≤‡∏¢ ${p}</div>`;
      }
      if(b&&i.num===b&&i.bottom>0){
        let p=i.bottom*70; if(isHalf(b)) p/=2;
        total+=p; search2Result.innerHTML+=`<div class="result">üë§ ${n} | ${mark(b)} ‡∏•‡πà‡∏≤‡∏á | ‡∏à‡πà‡∏≤‡∏¢ ${p}</div>`;
      }
    });
  }
  search2Result.innerHTML+=`<div class="total">‡∏£‡∏ß‡∏°‡∏à‡πà‡∏≤‡∏¢ ${total} ‡∏ö‡∏≤‡∏ó</div>`;
}

function search3(){
  search3Result.innerHTML=""; let total=0;
  const num=win3.value.trim(),norm=normalize3(num);
  for(let n in data){
    data[n].items.forEach(i=>{
      if(i.num===num&&i.straight>0){
        let p=i.straight*500; if(isHalf(num)) p/=2;
        total+=p; search3Result.innerHTML+=`<div class="result">üë§ ${n} | ${mark(num)} ‡∏ï‡∏£‡∏á | ‡∏à‡πà‡∏≤‡∏¢ ${p}</div>`;
      }
      if(i.tod>0&&normalize3(i.num)===norm){
        let p=i.tod*100; if(isHalf(num)) p/=2;
        total+=p; search3Result.innerHTML+=`<div class="result">üë§ ${n} | ${mark(i.num)} ‡πÇ‡∏ï‡πä‡∏î | ‡∏à‡πà‡∏≤‡∏¢ ${p}</div>`;
      }
    });
  }
  search3Result.innerHTML+=`<div class="total">‡∏£‡∏ß‡∏°‡∏à‡πà‡∏≤‡∏¢ ${total} ‡∏ö‡∏≤‡∏ó</div>`;
}

/* ================= UTIL ================= */
function saveImage(el){
  html2canvas(el).then(c=>{
    const a=document.createElement("a");
    a.href=c.toDataURL("image/png");
    a.download="summary.png";
    a.click();
  });
}
function exportCSV(){
  let csv="‡πÄ‡∏•‡∏Ç,‡∏ö‡∏ô,‡∏•‡πà‡∏≤‡∏á,‡∏ï‡∏£‡∏á,‡πÇ‡∏ï‡πä‡∏î,‡∏£‡∏ß‡∏°\n";
  document.querySelectorAll("#overallArea table tr").forEach((r,i)=>{
    if(i===0) return;
    csv+=[...r.children].map(td=>td.innerText).join(",")+"\n";
  });
  const a=document.createElement("a");
  a.href="data:text/csv;charset=utf-8,"+encodeURIComponent(csv);
  a.download="summary.csv";
  a.click();
}
function clearInputs(){
  [...numbers.querySelectorAll("input")].forEach(i=>i.value="");
  amount1.value=amountA.value=amountB.value="";
}
function clearAllData(){
  if(!confirm("‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?")) return;
  if(!confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏£‡∏¥‡∏á ‡πÜ ?")) return;
  data={}; halfNums=[];
  localStorage.clear(); render(); renderHalf();
}
</script>

</body>
</html>
